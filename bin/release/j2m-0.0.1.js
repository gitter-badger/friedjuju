!function e(n,t,r){function i(s,a){if(!t[s]){if(!n[s]){var d="function"==typeof require&&require;if(!a&&d)return d(s,!0);if(o)return o(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var c=t[s]={exports:{}};n[s][0].call(c.exports,function(e){var t=n[s][1][e];return i(t?t:e)},c,c.exports,e,n,t,r)}return t[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,n,t){function r(e,n){this.name=e,this.value=n}r.prototype.toString=function(){return" "+this.name+'="'+this.value+'"'},"undefined"!=typeof n&&(n.exports=r)},{}],2:[function(e,n,t){function r(e,n){this.tagName=e,this.attributes=[],this.children=[],"undefined"!=typeof n&&null!==n&&(n instanceof r?this.addChild(n):this.addChild(n.toString()))}var i=e("./Attr.js");r.prototype.addAttr=function(e){if(!(e instanceof i))throw new Error("Element.addAttr must be passed an instance of type: Attr");this.attributes.push(e)},r.prototype.getNumberedChildElementIndex=function(e,n){for(var t=-1,r=0;r<this.children.length;r++){var i=this.children[r];if(i.tagName===e&&(t++,t===n))return r}return-1},r.prototype.addChild=function(e,n){if(!(e instanceof r||e instanceof Array||"string"==typeof e))throw new Error("Element.addChild must be passed an Element instance, Array or a string");if("undefined"==typeof n)if(e instanceof Array)for(var t=0;t<e.length;t++)e[t].indexPos=n,this.children.push(e[t]);else this.children.push(e);else if(e instanceof Array)for(var t=e.length-1;t>=0;t--){e[t].indexPos=n;var i=this.getNumberedChildElementIndex(e[t].tagName,n);if(i>-1){var o=this.children[i].children,s=this.children[i].attributes;o.forEach(function(n){e[t].children.push(n)}),s.forEach(function(n){e[t].attributes.push(n)}),this.children[i]=e[t]}else this.children.push(e[t])}else{e.indexPos=n;var i=this.getNumberedChildElementIndex(e.tagName,n);if(i>-1){var o=this.children[i].children,s=this.children[i].attributes;o.forEach(function(n){e.children.push(n)}),s.forEach(function(n){e.attributes.push(n)}),this.children[i]=e}else this.children.push(e)}this.sortChildren()},r.prototype.sortChildren=function(){for(var e={},n=this.children.length-1;n>=0;n--){var t=this.children[n];if("number"==typeof t.indexPos){var r=e[t.tagName];r||(e[t.tagName]=r=[]),r.push({actualIndex:n,ele:t}),this.children[n]=null}}for(var i in e){var r=e[i];r.sort(function(e,n){return e.ele.indexPos-n.ele.indexPos});var o=[];r.forEach(function(e){o.push(e.actualIndex)}),o.sort();for(var s=0;s<o.length;s++){var t=r[s].ele,a=o[s];this.children[a]=t}}},r.prototype.toString=function(e){var n="number"==typeof e,t=void 0,i="";n&&(i="  ".repeat(e),t=e+1);var o=i+"<"+this.tagName;return this.attributes.forEach(function(e){o+=e.toString()}),o+=">",n&&this.children.length>0&&this.children[0]instanceof r&&(o+="\n"),this.children.forEach(function(e){o+=e.toString(t)}),n&&this.children.length>0&&this.children[0]instanceof r&&(o+=i),o+="</"+this.tagName+">",n&&(o+="\n"),o},"undefined"!=typeof n&&(n.exports=r)},{"./Attr.js":1}],3:[function(e,n,t){function r(e,n,t,i){if(this.id=e,this.value=n,this.index=t,this.children=[],i)if(i instanceof Array)for(var o=0;o<i.length;o++)this.children.push(i[o]);else{if(!(i instanceof r))throw new Error("Invalid children passed into Token constructor. Token #"+this.id);this.children.push(i)}}r.prototype.addChild=function(e){if(!(e instanceof r))throw new Error("Invalid Token being added to Token #"+this.id+"\n-> childToken = "+e.toString());this.children.push(e)},r.Literal="Literal","undefined"!=typeof n&&(n.exports=r)},{}],4:[function(e,n,t){function r(e,n){e instanceof Array||(e=[e]),this.tokenIds=e,this.fnHandler=n}var i={subscriptions:[],getSubscriptionsForToken:function(e){var n=[];return this.subscriptions.forEach(function(t){t.tokenIds.indexOf(e.id)>-1&&n.push(t)}),n},emit:function(e,n){this.subscriptions.forEach(function(e){e.fnHandler(n)})}},o={traverse:function(e){var n=i.getSubscriptionsForToken(e);n.length>0&&i.emit(n,e);for(var t=0;t<e.children.length;t++){var r=e.children[t];this.traverse(r)}},subscribe:function(e,n){var t=new r(e,n);i.subscriptions.push(t)}};"undefined"!=typeof n&&(n.exports=o)},{}],5:[function(e,n,t){var r=e("./Token.js"),i=e("./parserUtilsRestricted.js"),o=e("./parserUtilsExtended.js");for(var s in o)r[s]=s;var a={parseExtended:function(e){var n=0,t=o.Expression(e,n);if(t.newIndex<e.length)throw new Error("Unparsed characters exist at the end of the expression: "+e.substr(t.newIndex));return t},parseRestricted:function(e){var n=0,t=i.Expression(e,n);if(t.newIndex<e.length)throw new Error("Unparsed characters exist at the end of the expression: "+e.substr(t.newIndex));return t}};"undefined"!=typeof n&&(n.exports=a)},{"./Token.js":3,"./parserUtilsExtended.js":7,"./parserUtilsRestricted.js":8}],6:[function(e,n,t){var r=e("./Token.js"),i={checkMatch:function(e,n,t){return t>=e.length?void 0:e.substr(t,n.length)===n?{newIndex:t+n.length,token:new r(r.Literal,n,t)}:void 0},repeat0Plus:function(e,n,t,i){if(!(n>=e.length)){for(var o=n,s=new r(r[t],"",n);n<e.length&&(ret=i[t](e,n),ret);)s.addChild(ret.token),n=ret.newIndex;if(!(s.children.length<1))return s.value=e.substring(o,n),{newIndex:n,token:s}}},repeat1Plus:function(e,n,t,i){if(!(n>=e.length)){var o=n,s=new r(r[t],"",n),a=i[t](e,n);if(a){for(s.addChild(a.token),n=a.newIndex;n<e.length&&(a=i[t](e,n));)s.addChild(a.token),n=a.newIndex;return s.value=e.substring(o,n),{newIndex:n,token:s}}}},or:function(e,n,t,i,o){for(var s=n,a=void 0,d=-1,h=0;h<t.length;h++){var c=t[h],u=i[c](e,n);u&&d<u.newIndex&&(a=u.token,d=u.newIndex)}if(a){n=d;var l=new r(o,e.substring(s,n),n,a);return{newIndex:n,token:l}}}};"undefined"!=typeof n&&(n.exports=i)},{"./Token.js":3}],7:[function(e,n,t){var r=e("./Token.js"),i=e("./parserCommonFunctions.js"),o=e("./parserUtilsRestricted.js"),s={ExpressionPiece:function(e,n){return n>=e.length?void 0:i.or(e,n,["Wildcard","SingleObjectPlaceholder","NumberPrefixedElement","Attribute","Element","StringElement"],this,"ExpressionPiece")},Attribute:function(e,n){if(!(n>=e.length)){var t=n,o=i.checkMatch(e,"@",n);if(o){n=o.newIndex;var s=i.repeat1Plus(e,n,"Char",this);if(s)return n=s.newIndex,{newIndex:s.newIndex,token:new r(r.Attribute,e.substring(t,n),t,[o.token,s.token])}}}},BoundedAttributeExpression:function(e,n){if(!(n>=e.length)){var t=n,o=new r(r.BoundedAttributeExpression,"",n),s=i.checkMatch(e,"[",n);if(s){n=s.newIndex,o.addChild(s.token);var a=this.Attribute(e,n);if(a){n=a.newIndex,o.addChild(a.token);var d=i.checkMatch(e,"=",n);if(d){n=d.newIndex,o.addChild(d.token);var h=i.repeat1Plus(e,n,"Char",this);if(h){n=h.newIndex,o.addChild(h.token);var c=i.checkMatch(e,"]",n);if(c)return n=c.newIndex,o.addChild(c.token),o.value=e.substring(t,n),{newIndex:n,token:o}}}}}}},BoundedAttributeDeclaration:function(e,n){if(!(n>=e.length)){var t=n,o=new r(r.BoundedAttributeDeclaration,"",n),s=i.checkMatch(e,"[",n);if(s){n=s.newIndex,o.addChild(s.token);var a=this.Attribute(e,n);if(a){n=a.newIndex,o.addChild(a.token);var d=i.checkMatch(e,"]",n);if(d)return n=d.newIndex,o.addChild(d.token),o.value=e.substring(t,n),{newIndex:n,token:o}}}}},BoundedElementExpression:function(e,n){if(!(n>=e.length)){var t=n,o=new r(r.BoundedElementExpression,"",n),s=i.checkMatch(e,"[",n);if(s){n=s.newIndex,o.addChild(s.token);var a=this.ElementName(e,n);if(a){n=a.newIndex,o.addChild(a.token);var d=i.checkMatch(e,"=",n);if(d){n=d.newIndex,o.addChild(d.token);var h=i.repeat1Plus(e,n,"Char",this);if(h){n=h.newIndex,o.addChild(h.token);var c=i.checkMatch(e,"]",n);if(c)return n=c.newIndex,o.addChild(c.token),o.value=e.substring(t,n),{newIndex:n,token:o}}}}}}},BoundedElementDeclaration:function(e,n){if(!(n>=e.length)){var t=n,o=new r(r.BoundedElementDeclaration,"",n),s=i.checkMatch(e,"[",n);if(s){n=s.newIndex,o.addChild(s.token);var a=this.ElementName(e,n);if(a){n=a.newIndex,o.addChild(a.token);var d=i.checkMatch(e,"]",n);if(d)return n=d.newIndex,o.addChild(d.token),o.value=e.substring(t,n),{newIndex:n,token:o}}}}},ArrayIndex:function(e,n){if(!(n>=e.length)){var t=n,o=new r(r.ArrayIndex,"",n),s=i.checkMatch(e,"[",n);if(s){n=s.newIndex,o.addChild(s.token);var a=i.repeat1Plus(e,n,"Digit",this);if(a){n=a.newIndex,o.addChild(a.token);var d=i.checkMatch(e,"]",n);if(d)return n=d.newIndex,o.addChild(d.token),o.value=e.substring(t,n),{newIndex:n,token:o}}}}},Element:function(e,n){if(!(n>=e.length)){var t=n,i=new r(r.Element,"",n),o=this.ElementName(e,n);if(o){n=o.newIndex,i.addChild(o.token);var s=this.ElementTail(e,n);return s&&(n=s.newIndex,i.addChild(s.token)),i.value=e.substring(t,n),{newIndex:n,token:i}}}},ElementName:function(e,n){if(!(n>=e.length)){var t=n,o=new r(r.ElementName,"",n),s=this.Char(e,n),a=this.Digit(e,n);if(!a&&s){var d=i.repeat1Plus(e,n,"Char",this);if(d)return n=d.newIndex,o.addChild(d.token),o.value=e.substring(t,n),{newIndex:n,token:o}}}},ElementTail:function(e,n){if(!(n>=e.length)){for(var t=n,i=new r(r.ElementTail,"",n);n<e.length;){var o=void 0,s=-1,a=this.BoundedAttributeExpression(e,n);a&&(o=a.token,s=a.newIndex);var d=this.BoundedAttributeDeclaration(e,n);d&&s<d.newIndex&&(o=d.token,s=d.newIndex);var h=this.BoundedElementExpression(e,n);h&&s<h.newIndex&&(o=h.token,s=h.newIndex);var c=this.BoundedElementDeclaration(e,n);c&&s<c.newIndex&&(o=c.token,s=c.newIndex);var u=this.ArrayIndex(e,n);if(u&&s<u.newIndex&&(o=u.token,s=u.newIndex),!o)break;n=s,i.addChild(o)}if(!(i.children.length<1))return i.value=e.substring(t,n),{newIndex:n,token:i}}},Char:function(e,n){if(!(n>=e.length)){var t=this.Dot(e,n);if(!(t||(t=i.checkMatch(e,"=",n),t||(t=i.checkMatch(e,"@",n),t||(t=i.checkMatch(e,"[",n),t||(t=i.checkMatch(e,"]",n),t||(t=this.Wildcard(e,n),t||(t=this.SingleObjectPlaceholder(e,n)))))))))return{newIndex:n+1,token:new r(r.Char,e.substr(n,1),n)}}},Wildcard:function(e,n){if(!(n>=e.length)){var t=n,o=new r(r.Wildcard,"",n),s=i.checkMatch(e,"*",n);if(s){n=s.newIndex,o.addChild(s.token);var a=this.ElementTail(e,n);return a&&(n=a.newIndex,o.addChild(a.token)),o.value=e.substring(t,n),{newIndex:n,token:o}}}},SingleObjectPlaceholder:function(e,n){if(!(n>=e.length)){var t=n,o=new r(r.SingleObjectPlaceholder,"",n),s=i.checkMatch(e,"?",n);if(s){n=s.newIndex,o.addChild(s.token);var a=this.ElementTail(e,n);return a&&(n=a.newIndex,o.addChild(a.token)),o.value=e.substring(t,n),{newIndex:n,token:o}}}}};for(var a in o)"ExpressionPiece"!==a&&"Attribute"!==a&&"Element"!==a&&"Wildcard"!==a&&"SingleObjectPlaceholder"!==a&&"Usage1Char"!==a&&(s[a]=o[a]);"undefined"!=typeof n&&(n.exports=s)},{"./Token.js":3,"./parserCommonFunctions.js":6,"./parserUtilsRestricted.js":8}],8:[function(e,n,t){var r=e("./Token.js"),i=e("./parserCommonFunctions.js"),o={Expression:function(e,n){if(!(n>=e.length)){var t=n,i=new r(r.Expression,"",n),o=this.ExpressionPiece(e,n);if(o){for(n=o.newIndex,i.addChild(o.token);n<e.length;){var s=n,a=[],d=this.Dot(e,n);if(!d)break;if(n=d.newIndex,a.push(d.token),o=this.ExpressionPiece(e,n),o&&(n=o.newIndex,a.push(o.token)),!a){n=s;break}for(var h=0;h<a.length;h++)i.addChild(a[h])}return i.children.length>0?(i.value=e.substring(t,n),{newIndex:n,token:i}):void 0}}},Dot:function(e,n){if(!(n>=e.length)){var t=i.checkMatch(e,".",n);return t?{newIndex:t.newIndex,token:new r(r.Dot,e.substr(n,1),n)}:void 0}},ExpressionPiece:function(e,n){return n>=e.length?void 0:i.or(e,n,["NumberPrefixedElement","Attribute","Element","StringElement"],this,"ExpressionPiece")},Attribute:function(e,n){if(!(n>=e.length)){var t=n,o=i.checkMatch(e,"@",n);if(o){n=o.newIndex;var s=i.repeat1Plus(e,n,"Usage1Char",this);if(s)return n=s.newIndex,{newIndex:s.newIndex,token:new r(r.Attribute,e.substring(t,n),t,[o.token,s.token])}}}},Element:function(e,n){if(!(n>=e.length)){var t=n,o=i.repeat1Plus(e,n,"Usage1Char",this);return o?{newIndex:o.newIndex,token:new r(r.Element,o.token.value,t,[o.token])}:void 0}},NumberPrefixedElement:function(e,n){if(!(n>=e.length)){var t=n,o=new r(r.NumberPrefixedElement,"",n),s=i.checkMatch(e,"$",n);if(s){o.addChild(s.token),n=s.newIndex;var a=i.repeat1Plus(e,n,"Digit",this);if(a){o.addChild(a.token),n=a.newIndex;var d=this.Element(e,n);if(d)return o.addChild(d.token),n=d.newIndex,o.value=e.substring(t,n),{newIndex:n,token:o}}}}},StringElement:function(e,n){if(!(n>=e.length)){var t=i.checkMatch(e,"$str",n);return t?{newIndex:t.newIndex,token:new r(r.StringElement,e.substr(n,1),n)}:void 0}},Digit:function(e,n){if(!(n>=e.length))for(var t=0;9>=t;t++){var o=i.checkMatch(e,t.toString(),n);if(o)return{newIndex:o.newIndex,token:new r(r.Digit,e.substr(n,1),n)}}},Usage1Char:function(e,n){if(!(n>=e.length)){var t=this.Dot(e,n);if(!(t||(t=this.Wildcard(e,n),t||(t=this.SingleObjectPlaceholder(e,n),t||(t=i.checkMatch(e,"=",n),t||(t=i.checkMatch(e,"@",n),t||(t=i.checkMatch(e,"[",n),t||(t=i.checkMatch(e,"]",n)))))))))return{newIndex:n+1,token:new r(r.Usage1Char,e.substr(n,1),n)}}},Wildcard:function(e,n){if(!(n>=e.length)){var t=i.checkMatch(e,"*",n);return t?{newIndex:t.newIndex,token:new r(r.Wildcard,e.substr(n,1),n)}:void 0}},SingleObjectPlaceholder:function(e,n){if(!(n>=e.length)){var t=i.checkMatch(e,"?",n);return t?{newIndex:t.newIndex,token:new r(r.SingleObjectPlaceholder,e.substr(n,1),n)}:void 0}}};"undefined"!=typeof n&&(n.exports=o)},{"./Token.js":3,"./parserCommonFunctions.js":6}],9:[function(e,n,t){String.prototype.repeat=function(e){if(1>e)return"";for(var n="";e>0;)n+=this,e--;return n}},{}],10:[function(e,n,t){var r=e("./j2mTransformer.js"),i=e("./markupPrinter.js");"undefined"==typeof window&&(window={});var o=window.j2m={prettyPrint:!0,execute:function(e){var n=r.transform(e),t=this.prettyPrint?i.prettyPrint:i.print,o="";return n.children.forEach(function(e){o+=t.call(i,e)}),o}};"undefined"!=typeof n&&(n.exports=o)},{"./j2mTransformer.js":11,"./markupPrinter.js":12}],11:[function(e,n,t){e("./String-Extensions.js");var r=e("../expression-parser/Attr.js"),i=e("../expression-parser/Element.js"),o=e("./objectGraphCreator"),s={transform:function(e,n){if(n||(n=new i("__ROOT__")),"string"==typeof e)try{e=JSON.parse(e)}catch(t){var r=s.getStringAsMarkup(e);return n.addChild(r),n}else if("number"==typeof e||e instanceof Date||"boolean"==typeof e){var r=s.getStringAsMarkup(e.toString());return n.addChild(r),n}return s.transformObjectToMarkup(e,n),n},getStringAsMarkup:function(e){return e},transformObjectToMarkup:function(e,n){e instanceof Array&&e.forEach(function(e){s.transform(e,n)});var t=o.expand(e);for(var r in t){var i=t[r];if(r.indexOf(".")>-1)throw new Error("Found a dotted expression that was not expanded: "+r);if("@"===r[0]){var a=s.processAttr(r,i);n.addAttr(a)}else if("$str"===r)n.addChild(i);else if("$"===r[0]){var d=s.processNumberedElement(r,i);n.addChild(d.ele,d.index)}else{var h=s.processElement(r,i);n.addChild(h)}}},processAttr:function(e,n){return new r(e.substr(1),n.toString())},processElementWithPlainTextValue:function(e,n){return new i(e,n)},processNumberedElement:function(e,n){for(var t="",r=-1,i=1;i<e.length;i++)if(isNaN(e[i])){t=e.substr(i),r=parseInt(e.substr(1,i-1));break}if(""===t)throw new Error("Cannot resolve $ in property name: "+e);return{index:r,ele:this.processElement(t,n)}},processElement:function(e,n){if(n instanceof Array){var t=[];return n.forEach(function(n){var r=new i(e);s.transform(n,r),t.push(r)}),t}if("object"==typeof n){var r=new i(e);return s.transform(n,r),r}return s.processElementWithPlainTextValue(e,n)}};"undefined"!=typeof n&&(n.exports=s)},{"../expression-parser/Attr.js":1,"../expression-parser/Element.js":2,"./String-Extensions.js":9,"./objectGraphCreator":13}],12:[function(e,n,t){var r={print:function(e){return e.toString()},prettyPrint:function(e){return e.toString(0)}};"undefined"!=typeof n&&(n.exports=r)},{}],13:[function(e,n,t){var r=e("../expression-parser/ep.js"),i=e("../expression-parser/astEmitter.js"),o={create:function(e,n,t){var o=r.parseRestricted(e),s=void 0,a=void 0,d=void 0,h=[];return i.subscribe(["ExpressionPiece"],function(e){s||(s=n);var t=e.children[0],r={};a=t.value,h.push(a),s[a]?r=s[a]:s[a]=r,d=s,s=r}),i.traverse(o.token),d&&a?(d[a]=t,h):void 0},getPair:function(e,n){for(var t=0;t<e.length;t++){var r=e[t];if(r.keyToDelete===n)return r}}},s={expand:function(e){var n={},t=[];for(var r in e)if(n[r]=e[r],r.indexOf(".")>-1){var i=e[r],s=o.create(r,e,i);s&&t.push({keyToDelete:r,keyToAdd:s[0]})}var a={};for(var r in e){var d=o.getPair(t,r);d?a[d.keyToAdd]="__placeholder__":a[r]=e[r]}t.forEach(function(n){delete e[n.keyToAdd]});for(var r in n)e[r]=n[r];return a}};"undefined"!=typeof n&&(n.exports=s)},{"../expression-parser/astEmitter.js":4,"../expression-parser/ep.js":5}]},{},[10]),"undefined"!=typeof module&&(module.exports=window.j2m);