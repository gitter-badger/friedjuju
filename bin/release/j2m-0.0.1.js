(function e(n,r,t){function i(a,s){if(!r[a]){if(!n[a]){var o=typeof require=="function"&&require;if(!s&&o)return o(a,!0);if(d)return d(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var f=r[a]={exports:{}};n[a][0].call(f.exports,function(e){var r=n[a][1][e];return i(r?r:e)},f,f.exports,e,n,r,t)}return r[a].exports}var d=typeof require=="function"&&require;for(var a=0;a<t.length;a++)i(t[a]);return i})({1:[function(e,n,r){function t(e,n,r,i){this.id=e;this.value=n;this.index=r;this.children=[];if(i){if(i instanceof Array){for(var d=0;d<i.length;d++){this.children.push(i[d])}}else if(i instanceof t){this.children.push(i)}else{throw new Error("Invalid children passed into Token constructor. Token #"+this.id)}}}t.prototype.addChild=function(e){if(!(e instanceof t)){throw new Error("Invalid Token being added to Token #"+this.id+"\n-> childToken = "+e.toString())}this.children.push(e)};t.Literal="Literal";if(typeof n!=="undefined"){n.exports=t}},{}],2:[function(e,n,r){function t(e,n){if(!(e instanceof Array)){e=[e]}this.tokenIds=e;this.fnHandler=n}var i={subscriptions:[],getSubscriptionsForToken:function(e){var n=[];this.subscriptions.forEach(function(r){if(r.tokenIds.indexOf(e.id)>-1){n.push(r)}});return n},emit:function(e,n){this.subscriptions.forEach(function(e){e.fnHandler(n)})}};var d={traverse:function(e){var n=i.getSubscriptionsForToken(e);if(n.length>0){i.emit(n,e)}for(var r=0;r<e.children.length;r++){var t=e.children[r];this.traverse(t)}},subscribe:function(e,n){var r=new t(e,n);i.subscriptions.push(r)}};if(typeof n!=="undefined"){n.exports=d}},{}],3:[function(e,n,r){var t=e("./Token.js"),i=e("./parserCommonFunctions.js"),d=e("./parserUtilsRestricted.js"),a=e("./parserUtilsExtended.js");for(var s in a){t[s]=s}var o={parseExtended:function(e){var n=0;var r=a.Expression(e,n);if(r.newIndex<e.length){throw new Error("Unparsed characters exist at the end of the expression: "+e.substr(r.newIndex))}return r},parseRestricted:function(e){var n=0;var r=d.Expression(e,n);if(r.newIndex<e.length){throw new Error("Unparsed characters exist at the end of the expression: "+e.substr(r.newIndex))}return r}};if(typeof n!=="undefined"){n.exports=o}},{"./Token.js":1,"./parserCommonFunctions.js":4,"./parserUtilsExtended.js":5,"./parserUtilsRestricted.js":6}],4:[function(e,n,r){var t=e("./Token.js");var i={checkMatch:function(e,n,r){if(r>=e.length){return undefined}if(e.substr(r,n.length)===n){return{newIndex:r+n.length,token:new t(t.Literal,n,r)}}return undefined},repeat0Plus:function(e,n,r,i){if(n>=e.length){return undefined}var d=n;var a=new t(t[r],"",n);while(n<e.length){ret=i[r](e,n);if(ret){a.addChild(ret.token);n=ret.newIndex}else{break}}if(a.children.length<1){return undefined}a.value=e.substring(d,n);return{newIndex:n,token:a}},repeat1Plus:function(e,n,r,i){if(n>=e.length){return undefined}var d=n;var a=new t(t[r],"",n);var s=i[r](e,n);if(!s){return undefined}a.addChild(s.token);n=s.newIndex;while(n<e.length){s=i[r](e,n);if(s){a.addChild(s.token);n=s.newIndex}else{break}}a.value=e.substring(d,n);return{newIndex:n,token:a}},or:function(e,n,r,i,d){var a=n;var s=undefined,o=-1;for(var u=0;u<r.length;u++){var f=r[u];var h=i[f](e,n);if(h){if(o<h.newIndex){s=h.token;o=h.newIndex}}}if(s){n=o;var c=new t(d,e.substring(a,n),n,s);return{newIndex:n,token:c}}else{return undefined}}};if(typeof n!=="undefined"){n.exports=i}},{"./Token.js":1}],5:[function(e,n,r){var t=e("./Token.js"),i=e("./parserCommonFunctions.js"),d=e("./parserUtilsRestricted.js");var a={Attribute:function(e,n){if(n>=e.length){return undefined}var r=n;var d=i.checkMatch(e,"@",n);if(d){n=d.newIndex;var a=i.repeat1Plus(e,n,"Char",this);if(a){n=a.newIndex;return{newIndex:a.newIndex,token:new t(t.Attribute,e.substring(r,n),r,[d.token,a.token])}}}return undefined},BoundedAttributeExpression:function(e,n){if(n>=e.length){return undefined}var r=n;var d=new t(t.BoundedAttributeExpression,"",n);var a=i.checkMatch(e,"[",n);if(a){n=a.newIndex;d.addChild(a.token);var s=this.Attribute(e,n);if(s){n=s.newIndex;d.addChild(s.token);var o=i.checkMatch(e,"=",n);if(o){n=o.newIndex;d.addChild(o.token);var u=i.repeat1Plus(e,n,"Char",this);if(u){n=u.newIndex;d.addChild(u.token);var f=i.checkMatch(e,"]",n);if(f){n=f.newIndex;d.addChild(f.token);d.value=e.substring(r,n);return{newIndex:n,token:d}}}}}}return undefined},BoundedAttributeDeclaration:function(e,n){if(n>=e.length){return undefined}var r=n;var d=new t(t.BoundedAttributeDeclaration,"",n);var a=i.checkMatch(e,"[",n);if(a){n=a.newIndex;d.addChild(a.token);var s=this.Attribute(e,n);if(s){n=s.newIndex;d.addChild(s.token);d.value=e.substring(r,n);return{newIndex:n,token:d}}}return undefined},ArrayIndex:function(e,n){if(n>=e.length){return undefined}var r=n;var d=new t(t.ArrayIndex,"",n);var a=i.checkMatch(e,"[",n);if(a){n=a.newIndex;d.addChild(a.token);var s=i.repeat1Plus(e,n,"Digit",this);if(s){n=s.newIndex;d.addChild(s.token);var o=i.checkMatch(e,"]",n);if(o){n=o.newIndex;d.addChild(o.token);d.value=e.substring(r,n);return{newIndex:n,token:d}}}}return undefined},Element:function(e,n){if(n>=e.length){return undefined}var r=n;var i=new t(t.Element,"",n);var d=this.ElementName(e,n);if(d){n=d.newIndex;i.addChild(d.token);while(n<e.length){var a=undefined,s=-1;var o=this.BoundedAttributeExpression(e,n);if(o){a=o.token;s=o.newIndex}var u=this.BoundedAttributeDeclaration(e,n);if(u){if(s<u.newIndex){a=u.token;s=u.newIndex}}var f=this.ArrayIndex(e,n);if(f){if(s<f.newIndex){a=f.token;s=f.newIndex}}if(a){n=s;i.addChild(a)}else{break}}}else{return undefined}i.value=e.substring(r,n);return{newIndex:n,token:i}},ElementName:function(e,n){if(n>=e.length){return undefined}var r=n;var d=new t(t.ElementName,"",n);var a=i.repeat1Plus(e,n,"Char",this);if(a){n=a.newIndex;d.addChild(a.token)}else{return undefined}d.value=e.substring(r,n);return{newIndex:n,token:d}},Char:function(e,n){if(n>=e.length){return undefined}var r=this.Dot(e,n);if(r){return undefined}r=i.checkMatch(e,"=",n);if(r){return undefined}r=i.checkMatch(e,"@",n);if(r){return undefined}r=i.checkMatch(e,"[",n);if(r){return undefined}r=i.checkMatch(e,"]",n);if(r){return undefined}return{newIndex:n+1,token:new t(t.Char,e.substr(n,1),n)}}};for(var s in d){if(s!=="Attribute"&&s!=="Element"&&s!=="Usage1Char"){a[s]=d[s]}}if(typeof n!=="undefined"){n.exports=a}},{"./Token.js":1,"./parserCommonFunctions.js":4,"./parserUtilsRestricted.js":6}],6:[function(e,n,r){var t=e("./Token.js"),i=e("./parserCommonFunctions.js");var d={Expression:function(e,n){if(n>=e.length){return undefined}var r=n;var i=new t(t.Expression,"",n);var d=this.ExpressionPiece(e,n);if(!d){return undefined}n=d.newIndex;i.addChild(d.token);while(n<e.length){var a=n;var s=[];var o=this.Dot(e,n);if(o){n=o.newIndex;s.push(o.token);d=this.ExpressionPiece(e,n);if(d){n=d.newIndex;s.push(d.token)}}else{break}if(s){for(var u=0;u<s.length;u++){i.addChild(s[u])}}else{n=a;break}}if(i.children.length>0){i.value=e.substring(r,n);return{newIndex:n,token:i}}return undefined},Dot:function(e,n){if(n>=e.length){return undefined}var r=i.checkMatch(e,".",n);if(r){return{newIndex:r.newIndex,token:new t(t.Dot,e.substr(n,1),n)}}return undefined},ExpressionPiece:function(e,n){if(n>=e.length){return undefined}return i.or(e,n,["NumberPrefixedElement","Attribute","Element","StringElement"],this,"ExpressionPiece")},Attribute:function(e,n){if(n>=e.length){return undefined}var r=n;var d=i.checkMatch(e,"@",n);if(d){n=d.newIndex;var a=i.repeat1Plus(e,n,"Usage1Char",this);if(a){n=a.newIndex;return{newIndex:a.newIndex,token:new t(t.Attribute,e.substring(r,n),r,[d.token,a.token])}}}return undefined},Element:function(e,n){if(n>=e.length){return undefined}var r=n;var d=i.repeat1Plus(e,n,"Usage1Char",this);if(d){return{newIndex:d.newIndex,token:new t(t.Element,d.token.value,r,[d.token])}}},NumberPrefixedElement:function(e,n){if(n>=e.length){return undefined}var r=n;var d=new t(t.NumberPrefixedElement,"",n);var a=i.checkMatch(e,"$",n);if(a){d.addChild(a.token);n=a.newIndex;var s=i.repeat1Plus(e,n,"Digit",this);if(s){d.addChild(s.token);n=s.newIndex;var o=this.Element(e,n);if(o){d.addChild(o.token);n=o.newIndex;d.value=e.substring(r,n);return{newIndex:n,token:d}}}}return undefined},StringElement:function(e,n){if(n>=e.length){return undefined}var r=i.checkMatch(e,"$str",n);if(r){return{newIndex:r.newIndex,token:new t(t.StringElement,e.substr(n,1),n)}}return undefined},Digit:function(e,n){if(n>=e.length){return undefined}for(var r=0;r<=9;r++){var d=i.checkMatch(e,r.toString(),n);if(d){return{newIndex:d.newIndex,token:new t(t.Digit,e.substr(n,1),n)}}}return undefined},Usage1Char:function(e,n){if(n>=e.length){return undefined}var r=this.Dot(e,n);if(r){return undefined}r=this.Wildcard(e,n);if(r){return undefined}r=this.SingleObjectPlaceholder(e,n);if(r){return undefined}r=i.checkMatch(e,"=",n);if(r){return undefined}r=i.checkMatch(e,"@",n);if(r){return undefined}r=i.checkMatch(e,"[",n);if(r){return undefined}r=i.checkMatch(e,"]",n);if(r){return undefined}return{newIndex:n+1,token:new t(t.Usage1Char,e.substr(n,1),n)}},Wildcard:function(e,n){if(n>=e.length){return undefined}var r=i.checkMatch(e,"*",n);if(r){return{newIndex:r.newIndex,token:new t(t.Wildcard,e.substr(n,1),n)}}return undefined},SingleObjectPlaceholder:function(e,n){if(n>=e.length){return undefined}var r=i.checkMatch(e,"?",n);if(r){return{newIndex:r.newIndex,token:new t(t.SingleObjectPlaceholder,e.substr(n,1),n)}}return undefined}};if(typeof n!=="undefined"){n.exports=d}},{"./Token.js":1,"./parserCommonFunctions.js":4}],7:[function(e,n,r){function t(e,n){this.name=e;this.value=n}t.prototype.toString=function(){return" "+this.name+'="'+this.value+'"'};if(typeof n!=="undefined"){n.exports=t}},{}],8:[function(e,n,r){var t=e("./Attr.js");function i(e,n){this.tagName=e;this.attributes=[];this.children=[];if(typeof n!=="undefined"&&n!==null){if(n instanceof i){this.addChild(n)}else{this.addChild(n.toString())}}}i.prototype.addAttr=function(e){if(!(e instanceof t)){throw new Error("Element.addAttr must be passed an instance of type: Attr")}this.attributes.push(e)};i.prototype.addChild=function(e,n){if(!(e instanceof i)&&!(e instanceof Array)&&typeof e!=="string"){throw new Error("Element.addChild must be passed an Element instance, Array or a string")}if(typeof n==="undefined"){if(e instanceof Array){for(var r=0;r<e.length;r++){e[r].indexPos=n;this.children.push(e[r])}}else{this.children.push(e)}}else{if(e instanceof Array){for(var r=e.length-1;r>=0;r--){e[r].indexPos=n;this.children.push(e[r])}}else{e.indexPos=n;this.children.push(e)}}this.sortChildren()};i.prototype.sortChildren=function(){var e={};for(var n=this.children.length-1;n>=0;n--){var r=this.children[n];if(typeof r.indexPos==="number"){var t=e[r.tagName];if(!t){e[r.tagName]=t=[]}t.push({actualIndex:n,ele:r});this.children[n]=null}}for(var i in e){var t=e[i];t.sort(function(e,n){return e.ele.indexPos-n.ele.indexPos});var d=[];t.forEach(function(e){d.push(e.actualIndex)});d.sort();for(var a=0;a<d.length;a++){var r=t[a].ele;var s=d[a];this.children[s]=r}}};i.prototype.toString=function(e){var n=typeof e==="number";var r=undefined;var t="";if(n){t="  ".repeat(e);r=e+1}var d=t+"<"+this.tagName;this.attributes.forEach(function(e){d+=e.toString()});d+=">";if(n&&this.children.length>0&&this.children[0]instanceof i){d+="\n"}this.children.forEach(function(e){d+=e.toString(r)});if(n&&this.children.length>0&&this.children[0]instanceof i){d+=t}d+="</"+this.tagName+">";if(n){d+="\n"}return d};if(typeof n!=="undefined"){n.exports=i}},{"./Attr.js":7}],9:[function(e,n,r){String.prototype.repeat=function(e){if(e<1)return"";var n="";while(e>0){n+=this;e--}return n}},{}],10:[function(e,n,r){var t=e("./j2mTransformer.js"),i=e("./markupPrinter.js");if(typeof window==="undefined"){window={}}var d=window.j2m={prettyPrint:true,execute:function(e){var n=t.transform(e);var r=this.prettyPrint?i.prettyPrint:i.print;var d="";n.children.forEach(function(e){d+=r.call(i,e)});return d}};if(typeof n!=="undefined"){n.exports=d}},{"./j2mTransformer.js":11,"./markupPrinter.js":12}],11:[function(e,n,r){e("./String-Extensions.js");var t=e("./Attr.js"),i=e("./Element.js"),d=e("./objectGraphCreator");var a={transform:function(e,n){if(!n){n=new i("__ROOT__")}if(typeof e==="string"){try{e=JSON.parse(e)}catch(r){var t=a.getStringAsMarkup(e);n.addChild(t);return n}}else if(typeof e==="number"||e instanceof Date||typeof e==="boolean"){var t=a.getStringAsMarkup(e.toString());n.addChild(t);return n}a.transformObjectToMarkup(e,n);return n},getStringAsMarkup:function(e){return e},transformObjectToMarkup:function(e,n){if(e instanceof Array){e.forEach(function(e){a.transform(e,n)})}var r=d.expand(e);for(var t in r){var i=r[t];if(t.indexOf(".")>-1){throw new Error("Found a dotted expression that was not expanded: "+t)}else if(t[0]==="@"){var s=a.processAttr(t,i);n.addAttr(s)}else if(t==="$str"){n.addChild(i)}else if(t[0]==="$"){var o=a.processNumberedElement(t,i);n.addChild(o.ele,o.index)}else{var u=a.processElement(t,i);n.addChild(u)}}},processAttr:function(e,n){return new t(e.substr(1),n.toString())},processElementWithPlainTextValue:function(e,n){return new i(e,n)},processNumberedElement:function(e,n){var r="";var t=-1;for(var i=1;i<e.length;i++){if(isNaN(e[i])){r=e.substr(i);t=parseInt(e.substr(1,i-1));break}}if(r===""){throw new Error("Cannot resolve $ in property name: "+e)}return{index:t,ele:this.processElement(r,n)}},processElement:function(e,n){if(n instanceof Array){var r=[];n.forEach(function(n){var t=new i(e);a.transform(n,t);r.push(t)});return r}else if(typeof n==="object"){var t=new i(e);a.transform(n,t);return t}else{return a.processElementWithPlainTextValue(e,n)}}};if(typeof n!=="undefined"){n.exports=a}},{"./Attr.js":7,"./Element.js":8,"./String-Extensions.js":9,"./objectGraphCreator":13}],12:[function(e,n,r){var t={print:function(e){return e.toString()},prettyPrint:function(e){return e.toString(0)}};if(typeof n!=="undefined"){n.exports=t}},{}],13:[function(e,n,r){var t=e("../expression-parser/ep.js");var i=e("../expression-parser/astEmitter.js");var d={create:function(e,n,r){var d=t.parseRestricted(e);var a=undefined;var s=undefined,o=undefined;var u=[];i.subscribe(["ExpressionPiece"],function(e){if(!a){a=n}var r=e.children[0];var t={};s=r.value;u.push(s);if(!a[s]){a[s]=t}else{t=a[s]}o=a;a=t});i.traverse(d.token);if(o&&s){o[s]=r;return u}return undefined},getPair:function(e,n){for(var r=0;r<e.length;r++){var t=e[r];if(t.keyToDelete===n){return t}}return undefined}};var a={expand:function(e){var n=[];for(var r in e){if(r.indexOf(".")>-1){var t=e[r];var i=d.create(r,e,t);if(i){n.push({keyToDelete:r,keyToAdd:i[0]})}}}var a={};for(var r in e){var s=d.getPair(n,r);if(!s){a[r]=e[r]}else{a[s.keyToAdd]="__placeholder__"}}n.forEach(function(n){delete e[n.keyToAdd]});return a}};if(typeof n!=="undefined"){n.exports=a}},{"../expression-parser/astEmitter.js":2,"../expression-parser/ep.js":3}]},{},[10]);if(typeof module!=="undefined"){module.exports=window.j2m}